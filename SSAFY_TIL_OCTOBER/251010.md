---

## 251010

---

### [Objectives_ 학습 목표]

- 정적 파일(Static)과 미디어 파일(Media)의 차이점을 명확히 설명할 수 있음
- Django에서 정적 파일의 역할과 처리 과정을 이해하고, CSS, JS, 이미지 파일을 프로젝트에 적용할 수 있음
- STATICFILES_DIRS를 설정하여 여러 경로에 있는 정적 파일을 효율적으로 관리할 수 있음
- Django에서 미디어 파일의 처리 과정을 이해하고, 사용자가 업로드하는 파일을 서버에 저장하고 관리할 수 있음
- MEDIA_ROOT와 MEDIA_URL을 설정하여 업로드 된 파일을 사용자에게 보여줄 수 있음
- ImageField와 ModelForm을 활용하여 이미지 업로드 기능을 구현할 수 있음

---

### [Build_ 이론]

### Static files_ 정적 파일

: 서버 측에서 변경되지 않고 고정적으로 제공되는 파일

→ 식당에서 비치된 ‘인쇄된 메뉴판’과 같음

→ 메뉴판은 손님이 바뀐다고 해서 내용이 변하지 않고, 항상 동일한 모습으로 제공됨

→ 대표적인 종류 : CSS 파일, JavaScript 파일, 이미지 파일, 폰트 파일

### 웹 서버와 정적 파일

**웹 서버의 기본 역할**

: “요청 받은 주소(URL)에 해당하는 자원을 찾아 응답해주는 것”

: 마치 도서관 사서에게  “A-3 구역의 3번째 책을 주세요”라고 요청하면, 사서가 해당 위치로 가서 책을 찾아 건네 주는 것과 같음

→ ‘A-3 구역의 3번째’가 URL, ‘책’이 자원(Resource)에 해당

**정적 파일과 URL의 관계**

: 웹 서버가 제공하는 가장 기본적인 지원이 바로 정적 파일(Static Files)

- 정적 파일 제공
    
    : 웹 서버는 요청 받은 URL을 보고, 서버 컴퓨터의 특정 폴더에 저장된 CSS, JS, 이미지 같은 정적 파일을 찾아 제공
    
- URL의 필요성
    
    : “정적 파일이 사용자에게 보이려면, 그 파일에 접근할 수 있는 고유한 주소(URL)가 반드시 필요하다”는 의미
    

**처리 과정 요약**

1. 사용자 : 브라우저에 http://example.com/images/logo.png라는 주소를 입력하여 이미지 요청
2. 웹 서버 : /images/logo.png라는 URL을 확인하고, 서버에 미리 약속된 폴더에서 logo.png 파일을 찾음
3. 웹 서버 : 찾은 이미지 파일을 HTTP 응답에 담아 사용자에게 전송
4. 사용자 : 브라우저가 응답 받은 이미지 파일을 화면에 보여줌
    
    ![image.png](attachment:7093516b-8de0-4b6a-a7fb-3364d3584626:image.png)
    

**Static files 경로의 종류**

1. 기본 경로
2. 추가 경로

### Static files 기본 경로

**정적 파일이 위치해야 하는 기본 경로**

: app폴더/static/

**기본 경로 CSS 스타일 제공하기**

- articles/static/stylesheets/ 경로에 CSS 파일 배치하기

![image.png](attachment:daed207d-48d9-450e-af02-9cc05e7fd891:image.png)

- 메인 페이지에 CSS 파일 불러오기
- static files 경로는 DTL의 static tag를 사용해야 함
- built-in tag가 아니기 때문에 load tag를 사용해 import 후 사용 가능

![image.png](attachment:9c6d0aec-f0a4-49d9-ad4d-2ec76f956e54:image.png)

→ app폴더/static/ 경로 이후 경로를 작성

- CSS가 적용된 것을 확인
- static tag가 어떤 주소를 만들어 냈는지 확인

![image.png](attachment:a25b4142-a107-4c94-aeb5-204289409892:image.png)

→ http://로 시작하는 웹 주소가 존재하는 것을 알 수 있음

**{% load %}**

: 특정 라이브러리와 태그와 필터를 현재 템플릿에서 사용할 수 있도록 불러오는 역할

: {% load static %}은 {% static %}태그를 사용하기 위해, Django 템플릿 시스템에 “이제부터 static 관련 태그를 사용하겠다.”고 알려주는 선언문

→ load 태그는 템플릿 파일의 가장 상단에 한 번만 작성하면 됨(extends 보다는 아래에 위치)

**{% static ‘경로’ %}**

: [settings.py](http://settings.py) 파일의 STATIC_URL 값을 기준으로, 해당 정적 파일의 전체 URL 경로를 계산하여 생성

: 예를 들어, STATIC_URL = ‘static/’이고 CSS 파일이 static/css/style.css에 위치한다면, 경로가 필요한 위치에 {% static ‘css/style.css’ %}로 작성

**STATIC_URL**

: 정적 파일의 ‘웹 주소’

→ 웹 페이지에서 정적  파일에 접근할 대 사용할 URL의 시작 부분(접두사)을 지정하는 설정

→ 서버 컴퓨터에 저장된 실제 파일 경로가 아니라, 오직 웹(브라우저)에서만 사용되는 주소

→ 서버의 정적 파일 폴더에 ‘static/’이라는 웹 주소 별명을 붙여주는 것과 같음

→ 브라우저가 이 별명으로 파일을 요청하면, Django는 약속된 실제 폴더에서 파일을 찾아 응답해줌

→ 기본 값 : ‘static/’

**기본 경로 이미지 파일 제공하기**

- articles/static/images/ 경로에 이미지 파일 배치하기

![image.png](attachment:9712e994-0dfd-4fca-846c-22ca9d9c5078:image.png)

- DTL의 static tag를 사용해 이미지 경로 작성하긴

![image.png](attachment:42c85a15-e0d0-4c28-9275-65430b6f4599:image.png)

- 제공된 이미지의 URL 확인

![image.png](attachment:02059ed7-f7b2-4188-8e0b-35728c5092d2:image.png)

- 정적 파일 URL이 만들어지기까지
    
    ⇒  URL + STATIC_URL + 정적 파일 경로
    

### Static files 추가 경로

**기본 경로 외 추가 경로 지정**

: STATICFILES_DIRS에 문자열로 추가 경로를 설정

**STATICFILES_DIRS**

: 기본 경로 외에 추가적으로 탐색할 경로의 목록을 저장하는 리스트

→ 기본 도서관 외에 책을 보관하는 ‘외부 창고’들의 주소 목록을 알려주는 것과 같음

→ Django는 목록에 있는 모든 폴더를 방문하여 필요한 정적 파일을 찾음

→ 여러 앱에서 공통으로 사용되는 CSS 프레임워크(ex : Bootstrap)나 JavaScript 라이브러리처럼 특정 앱에 속하지 않는 정적 파일들을 프로젝트 최상위 폴더(BASE_DIR) 같은 곳에 모아두고 관리할 때 매우 유용함

**STATICFILES_DIRS 설정**

![image.png](attachment:a4fad05d-0a93-4a2d-982d-42b1c789bf48:image.png)

→ Django는 기본 경로인 각 앱의 static/ 폴더를 모두 확인한 후, 프로젝트의 최상위 폴더에 있는 static/ 폴더도 추가로 탐색하게 됨

**추가 경로 이미지 파일 제공하기**

- 설정한 추가 경로에 이미지 파일 배치하기

![image.png](attachment:39c57422-d206-458d-b865-bdf3783993a3:image.png)

- DTL의 static tag를 사용해 이미지 경로를 작성하기

![image.png](attachment:200f71a9-21d2-4bff-bcd3-51e9543e96e2:image.png)

- 제공된 이미지의 URL 확인

![image.png](attachment:7de18dec-d51f-4e0b-8d21-edd16a98fe78:image.png)

**정적 파일의 핵심 원리 : 주소(URL)가 있어야 찾아갈 수 있다**

: 컴퓨터에 파일이 존재하는 것만으로는 웹 페이지에 보일 수 없음

: 외부의 손님(브라우저)이 파일을 찾아올 수 있도록 반드시 ‘웹 주소(URL)’라는 문패를 달아줘야 함

![image.png](attachment:4fc5b1f9-1fe7-4edd-9665-345b239f514d:image.png)

### Media files_ 미디어 파일

: 사용자가 웹 사이트를 통해 직접 업로드하는 파일

→ Static Files이 사이트 개발자가 미리 준비해 둔 ‘고정된’ 파일이라면, Media Files는 사이트 운영 중 사용자에 의해 생성되고 변경되는 ‘동적인’ 파일

→ 쇼핑몰의 기본 로고나 아이콘은 정적 파일이고, 사용자가 상품 후기를 작성하며 올리는 상품 사진은 미디어 파일인 것과 같음

### 이미지 업로드

**Image Field()**

: 이미지 파일을 업로드하기 위해 사용하는 Django 모델 필드

: 데이터 베이스 저장 방식

- 가장 중요한 특징은 이미지 파일 자체가 데이터 베이스에 저장되는 것이 아니라는 점
- 데이터 베이스에는 upload_to 경로를 기준으로 한 이미지 파일의 경로(문자열)만 저장되고, 실제 파일은 서버의 특정 폴더(MEDIA_ROOT)에 저장

![image.png](attachment:9abb089e-af18-486b-bccf-68f79e3b5962:image.png)

→ upload_to는 선택 인자

**미디어 파일을 제공하기 전 준비 사항**

1. settings.py에 MEDIA_ROOT, MEDIA_URL 설정
2. 작성한 MEDIA_ROOT와 MEDIA_URL에 대한 URL 지정

**MEDIA_ROOT**

: 미디어 파일의 ‘실제 창고’ 주소

→ 사용자가 업로드한 미디어 파일들이 서버 컴퓨터 어디에 저장될 지를 지정하는 절대 경로

→ 서버 내부에서만 사용하는 물리적인 폴더 주소로,  Django는 파일을 저장하거나 읽어올 때 이 경로를 사용함

![image.png](attachment:7a7731f4-93f7-4bee-b761-d17aa4f73a77:image.png)

**MEDIA_URL**

: 미디어 파일의 ‘웹 주소’ 별명

→ MEDIA_ROOT에 저장된 파일들을 웹 페이지에서 접근할 때 사용할 URL의 시작 부분을 지정함

→ STATIC_URL과 동일한 역할로, 실제 저장 위치를 숨기고 웹에서 사용할 공개 주소 별명을 만들어 주는 것임

![image.png](attachment:3f4ed946-1993-4d93-859e-a84cf2d7b159:image.png)

**MEDIA_ROOT와 MEDIA_URL 설정**

- MEDIA_ROOT는 파일을 저장하고 관리하기 위한 서버의 실제 경로이고, MEDIA_URL은 그 파일을 웹에서 보여주기 위한 가상의 주소

![image.png](attachment:dc6c99a7-03a2-497d-bfb0-bfa6e6c60217:image.png)

- settings.MEDIA_URL : “media/로 시작하는 URL 요청이 오면”
- document_root = settings.MEDIA_ROOT : “MEDIA_ROOT에 지정된 실제 폴더에서 파일을 찾아라”

![image.png](attachment:abcd5ddb-dfb3-46db-8af1-05e6bb778afd:image.png)

![image.png](attachment:dfdbed61-41fb-4fbe-84dc-3ee64f05a786:image.png)

**이미지 업로드 구현**

- Article 모델 클래스에 image 필드 작성
- blank = True 속성을 작성해 빈 문자열이 저장될 수 있도록 제약 조건 설정
    
    → 게시글 작성 시 이미지 첨부 없이도 작성할 수 있도록 하기 위함
    
    ![image.png](attachment:014a46c7-f096-4d59-88f6-fdf1c3c15663:image.png)
    
    → 기존 필드 사이에 작성해도 실제 테이블 생성 시에는 가장 우측(뒤)에 추가됨
    
- migration 진행 과정 중 에러 발생

![image.png](attachment:c045119e-c5f4-451e-91c8-a1b2fa244c58:image.png)

→ ImageField를 사용하려면 반드시 Pillow 라이브러리 필요함

- Pillow  설치 후 migrations 재진행

![image.png](attachment:53137110-5c47-4cde-a7fe-2e082dfca4ca:image.png)

- form 요소의 enctype 속성 추가

![image.png](attachment:beb0d159-cb01-460b-875e-0441a3e89453:image.png)

→ 파일 업로드 시에는 반드시 multipart/form-data로 설정해야 함

- ModelForm의 2번째 인자로 요청 받은 파일 데이터 작성

![image.png](attachment:aab255c6-893a-424c-809a-c6208eb40403:image.png)

![image.png](attachment:46301df2-f9ad-462a-9faa-5902e5cf8c85:image.png)

- 게시글 작성 페이지에서 새로 추가된 input 태그 확인

![image.png](attachment:7567bbcd-b95e-4d51-b4c1-1fa15c5708b7:image.png)

- 이미지 업로드 후 이미지 파일 위치 확인
    - MEDIA_ROOT 경로에 업로드 된 이미지 확인

![image.png](attachment:8d574658-2ac2-4a2a-b84d-9d6b12df7050:image.png)

- 이미지 업로드 후 DB 확인
    - 이미지 파일 자체가 데이터 베이스에 저장되는 것이 아닌 upload_to 경로를 기준으로 한 이미지 파일의 경로(문자열)만 저장
    
    ![image.png](attachment:b479663e-a097-42d9-8540-f170245aeb3e:image.png)
    
    → 데이터 베이스의 용량을 가볍게 유지하고 성능을 높이는 데 매우 효율적임
    

**게시글 상세 페이지에 업로드한 이미지 제공하기**

- ImageField의 .url 속성
    - 업로드 파일의 웹 주소
    - ImageField나 FileField에 저장된 파일 객체에서 .url 속성을 사용하면, 해당 파일을 웹에서 접근할 수 있는 전체 URL 주소를 얻을 수 있음
    
    ![image.png](attachment:a4f4d0ab-c220-4ad4-b2a9-be73ce5cf5f4:image.png)
    
    → 이미지를 업로드하지 않은 게시물은 detail 템플릿을 렌더링할 수 없음
    
    → 이미지 데이터가 있는 경우만 이미지를 출력할 수 있도록 if 태그 활용
    
- 업로드 이미지 출력 확인 및 URL 확인

![image.png](attachment:049808eb-316e-4f55-805e-3b83f12b3ed9:image.png)

**업로드 이미지 수정**

- 수정 페이지 form 요소에 enctype 속성 추가

![image.png](attachment:d460b46f-6925-4a9f-98da-adfb519d1bfb:image.png)

- update view 함수에서 업로드 파일에 대한 추가 코드 작성

![image.png](attachment:6be0bf3c-7a9f-4d71-8da5-9964e32c47f0:image.png)

---

### 참고

**upload_to 활용**

: 단순한 문자열 경로 외에도, 업로드 경로를 동적으로 생성하는 두 가지 유용한 방법을 제공함

1. 날짜를 이용한 경로 구성
    - strftime()의 형식 코드를 사용하여 파일이 업로드된 날짜를 기준으로 폴더를 자동으로 생성할 수 있음
        - %Y : 4자리 연도
        - %m : 2자일 월
        - %d : 2자리 일
        
        ![image.png](attachment:0db87f9f-5c99-4277-94a1-da26202688b7:image.png)
        
2. 함수를 이용한 동적 경로 생성
    - 더 복잡한 로직으로 경로를 만들고 싶을 때는 upload_to에 함수를 직접 전달할 수 있음
    - 함수는 두 가지 인자를 받음
        - instance : 파일이 첨부된 모델의 인스턴스(해당 게시글 객체 등)
        - filename : 업로드 된 파일의 원본 이름
        
        ![image.png](attachment:75a24250-fb3a-4959-8b57-47bccd8c4bd2:image.png)
        
        → 특정 유저의 폴더에 파일을 저장하는 등 매우 유연한 경로 생성이 가능함
        

**AWS 인프라 이해하기**

- AWS(Amazon Web Services)
    - 아마존이 제공하는 클라우드 컴퓨팅 플랫폼
    - 서버, 스토리지, 데이터 베이스 같은 IT 인프라를 직접 구매하지 않고, 인터넷을 통해 필요한 만큼 빌려 쓰는 서비스
- AWS 핵심 서비스 3가지

![image.png](attachment:2d44d05e-6beb-48f9-8273-6fc61de5c968:image.png)

- EC2, S3, RDS를 활용한 웹 서비스 구축
    - EC2(서버)
        
        : 웹 애플리케이션(Django)이 실행되는 컴퓨터의 역할
        
    - S3(파일 저장소)
        
        : 사용자가 올린 이미지나 사이트의 로고 등 정적 파일을 보관하는 외부 창고 역할
        
    - RDS(데이터 베이스)
        
        : 회원 정보, 게시글 등 중요한 데이터를 기록하고 관리하는 장부 역할
        
- 데이터 흐름도 요약

![image.png](attachment:4354e1b6-3687-4c90-b1c6-429a44041f13:image.png)

![image.png](attachment:a8d0080f-6d63-4cc6-b5c6-6d4b99920a1e:image.png)

- 클라우드 컴퓨팅 플랫폼을 사용하는 이유
    - 비용 절감
        
        : 물리 장비를 직접 구매할 필요 없이, 사용한 만큼만 비용을 지불
        
    - 유연성과 확장성
        
        : 필요에 따라 서버 사양이나 저장 공간 용량을 몇 번의 클릭만으로 자유롭게 조절할 수 있음
        
    - 글로벌 서비스
        
        : 전 세계에 위치한 데이터 센터를 통해 어떤 국가의 사용자들에게도 빠르고 안정적인 서비스를 제공할 수 있음
        

**BaseModelForm**

- BaseModelForm의 생성자 함수 인자 구성
    
    : ModelForm의 상위 클래스 BaseModelForm의 생성자 함수 키워드 인자 순서 참고하기
    
    ![image.png](attachment:350f7ba7-5473-4ae7-a751-0434264218ae:image.png)