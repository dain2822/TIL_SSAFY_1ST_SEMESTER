## 251113

### [Objectives_ 학습 목표]

- DRF에서 N : 1 관계를 표현하는 방법을 이해함
- 외래 키(ForeignKey)를 사용하는 모델 구조를 설계할 수 있음
- 댓글 데이터를 조회(GET), 생성(POST), 수정(PUT), 삭제(DELETE)하는 API를 구현할 수 있음
- read_only_fields를 활용해 클라이언트의 수정이 불가능한 필드를 설정할 수 있음
- SerializerMethodField를 사용해 응답에 추가적인 정보를 포함하는 방법을 익힘
- 역참조를 통해 부모 객체에서 자식 객체 목록 또는 개수를 응답에 포함하는 방법을 설명할 수 있음
- annotate를 사용해 모델 데이터를 집계하고, serializer에서 이를 활용할 수 있음
- get_object_or_404, get_list_or_404를 활용해 예외 처리를 구현할 수 있음

---

### [Build_ 이론]

### DRF with N:1 Relation

**사전 준비**

- Comment 모델 클래스 정의
    
    ![image.png](attachment:4add3f4f-98c0-40db-8503-0ae06bb44fdc:image.png)
    
- Articles app에 정의된 모델 정보 makemigration
    
    ![image.png](attachment:7bd58fc5-b7bd-492a-96fd-93d05b4cd2ec:image.png)
    
- 데이터베이스 초기화
    
    ![image.png](attachment:44d39426-bc91-4aa5-8405-893119b6b95f:image.png)
    
- fixtures 데이터 삽입
    
    ![image.png](attachment:6072b958-3b50-41d6-8d73-b232e2feac34:image.png)
    

**URL 및 HTTP request method 구성**

![image.png](attachment:d517bf82-3fc5-4cda-8329-f9436226b2c7:image.png)

### GET method

**GET_ List**

- 댓글 목록 조회를 위한 CommentSerializer 정의
    
    ![image.png](attachment:5bc9181e-f644-445e-8008-aecdae6e9064:image.png)
    
- url 작성
    
    ![image.png](attachment:57c2808e-f2c2-4494-a53b-566cb2153aab:image.png)
    
- view 함수 작성
    
    ![image.png](attachment:1bb5bbef-aa7f-40f4-9616-4b6d3375e45a:image.png)
    
    ![image.png](attachment:190c7d22-baf2-4d97-8efb-8454edf6175b:image.png)
    

**GET_ Detail**

- 단일 댓글 조회를 위한 url 및 view 함수 작성
    
    ![image.png](attachment:38afa0d7-7199-4080-850b-46d733fc0327:image.png)
    
    ![image.png](attachment:98407661-d123-4db2-93f7-3ad9cc0cb62d:image.png)
    

### POST method

- 단일 댓글 생성을 위한 url 및 view 함수 작성
    
    ![image.png](attachment:da7c0174-83b7-4482-84fb-b70a1613c54b:image.png)
    
- serializer 인스턴스의 save() 메서드는 특정 Serializer 인스턴스를 저장하는 과정에서 추가 데이터를 받을 수 있음
    
    ![image.png](attachment:e3a63eec-2d90-4b1b-8dc1-09ec7ed597cb:image.png)
    
    ![image.png](attachment:a598d5de-7c9c-43b1-8281-0120474490c4:image.png)
    
    → CommentSerializer에서 외래 키에 해당하는 article field 또한 사용자로부터 입력 받도록 설정되어 있기 때문에 서버 측에서는 누락되었다고 판단한 것
    
    → 유효성 검사 목록에서 제외가 필요함
    
    ⇒ article field를 **읽기 전용 필드**로 설정
    
- 데이터를 전송 받은 시점에 “유효성 검사에서 제외시키고, 데이터 조회 시에는 출력”하는 필드
    
    ![image.png](attachment:a7bd9868-efdd-4ba4-bdbd-947990074897:image.png)
    
    ![image.png](attachment:ac5199f1-d0d7-4461-9478-2dca27b9deaa:image.png)
    

### 읽기 전용 필드(read_only_fields)

: 서버가 조회 요청에 대한 응답 시에만 값을 표시하는 필드

→ read_only_fields는 클라이언트가 입력해서는 안 되는 필드를 응답 전용 필드로 지정할 때 사용함

→ view에서 값을 직접 주입할 필드는 반드시 read_only_fields로 지정

**읽기 전용 필드 사용 목적**

- 클라이언트 측에서 직접 수정하면 안 되는 경우
- 서버 로직에 의해 자동 생성, 관리되는 값 활용
- 입력은 받지 않지만 정보를 제공해야 하는 경우
- 새로운 필드 값(추가 계산, 가공)을 만들어 제공해야 하는 경우