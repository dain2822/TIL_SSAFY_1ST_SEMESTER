## 250923


### [Objectives_ 학습 목표]

- Django Model 클래스를 이용해 데이터베이스 테이블 구조를 설계하고 “설계도(blueprint)” 역할을 설명할 수 있음
- 다양한 Field type과 Field option을 지정해 컬럼의 데이터 유형과 제약 조건을 정의할 수 있음
- python [manage.py](http://manage.py) makemigrations / migrate 두 단계로 모델 변경 사항을 안전하게 데이터 베이스에 반영할 수 있음
- admin.site.register()로 모델을 Django Admin에 등록하여 웹 UI에서 게시글을 생성, 조회, 수정, 삭제(CRUD)할 수 있음
- Django 기본 DB 엔진인 SQLite의 특성과 db.sqlite3를 Git에서 제외해야 하는 이유를 설명할 수 있음

---

### [Build_ 이론]

### Model

: 데이터 베이스와 Python 클래스(객체)로 추상화된 형태로 상호작용함

→ Django의 강력한 기능 : 개발자가 데이터 베이스에 대한 깊은 지식이 없어도 쉽게 데이터 관리 가능

→ 유지 보수 및 확장성 증대 : 데이터 베이스 변경 시에도 코드 수정 최소화, 재사용 가능한 데이터 모델을 통해 개발 효율성 향상

**Model을 통한 DB(데이터베이스) 관리**

![image.png](attachment:29edfddc-acaf-4925-b0bf-6610a8f52f42:image.png)

- [urls.py](http://urls.py) : 사용자 요청의 시작점
- [views.py](http://views.py) : 요청을 처리하고 models.py를 통해 데이터를 다룸
- [models.py](http://models.py) : 데이터 베이스를 정의하고, 데이터 베이스와 상호작용
- templates : views.py로부터 받은 데이터를 사용자에게 보여줄 화면을 구성

### **Model class**

: DB의 테이블을 정의하고 데이터를 조작할 수 있는 기능들을 제공

→ 데이터 베이스 테이블의 구조를 설계하는 ‘청사진(blueprint)’ 역할을 함

→ 어떤 데이터(컬럼)를 저장할 지, 데이터의 형태는 어떠할 지(타입, 길이 등)를 Python 코드로 명확히 정의함

**Model class 작성**

- articles 앱의 models.py에 코드 작성

![image.png](attachment:ecb368ba-8198-4362-ab21-bae46183cd9a:image.png)

- 작성한 모델 클래스는 최종적으로 DB에 다음과 같은 테이블 구조를 만듦

![image.png](attachment:99789cbb-ec7e-480c-ab2a-0c6d7650b4bc:image.png)

- django.db.models 모듈의 Model이라는 부모 클래스를 상속받음
    - Model은 model에 관련된 모든 코드가 이미 작성 되어있는 Class
        
        → 개발자는 가장 중요한 테이블 구조를 어떻게 설계할 지에 대한 코드만 작성하도록 하기 위한 것(”상속”을 활용한 프레임워크의 기능 제공)
        
        ![image.png](attachment:6649a138-2264-4d24-a176-3ecd832bcd53:image.png)
        
- 클래스 변수명
    - 테이블의 각 “필드(열) 이름”
    
    ![image.png](attachment:998f29a2-58bf-4d9e-96b1-875c00a1665d:image.png)
    
- Model Field
    - 데이터 베이스 테이블의 열(column)을 나타내는 중요한 구성 요소
    - “데이터의 유형”과 “제약 조건”을 정의
    
    ![image.png](attachment:9ae151c0-8dbd-408e-bea7-ead9154a499e:image.png)
    
    → CharField의 max_length 매개변수를 지정하는 것은 선택 사항
    
    → SQLite는 문자열 컬럼의 길이에 대한 엄격한 제한을 강제하지 않기 때문
    
    → 유효성 검사 및 컬럼에 들어갈 데이터의 명확성을 위해 명시적으로 설정하는 것은 매우 권장됨
    

### Model Field

: DB 테이블의 필드(열) 정의

: 데이터 타입(Field types) 및 제약 조건(Field options) 명시

→ Django는 이러한 필드 정의를 바탕으로 데이터 베이스 컬럼을 자동으로 생성하고, 데이터 입력 시 유효성 검사 등 필요한 기능을 제공함

→ 정확한 필드 정의는 애플리케이션의 안정성을 높이는데 필수적임

1. Field types(필드 유형)
    
    : 데이터 베이스에 저장될 “데이터의 종류”를 정의
    
    → models 모듈의 클래스로 정의되어 있음
    
    ![image.png](attachment:14e0340c-d6c9-4af6-93db-267c058f5807:image.png)
    
    - CharField()
        
        : 제한된 길이의 문자열을 저장(필드의 최대 길이를 결정하는 max_length는 선택 옵션)
        
    - TextField()
        
        : 길이 제한이 없는 대용량 텍스트를 저장(무한대는 아니며 사용하는 시스템에 따라 달라짐)
        
    - 주요 필드 유형
        1. 문자열 필드
            
            : CharField, TextField
            
        2. 날짜/시간 필드
            
            : DataField, TimeField, DataTimeField
            
        3. 숫자 필드
            
            : IntegerField, FloatField
            
        4. 파일 관련 필드
            
            : FileField, ImageField
            
    
2. Field options(필드 옵션)
    
    : 필드의 “동작”과 “제약 조건”을 정의
    
    ![image.png](attachment:de76e90b-968f-4446-90ac-cd011d596117:image.png)
    
    - 제약 조건(Constraint)
        
        : 특정 규칙을 강제하기 위해 테이블의 열이나 행에 적용되는 규칙이나 제한 사항
        
        ex) 숫자만 저장되도록 제한을 두거나, 문자가 100자까지만 저장되도록 하는 등의 제한 조건
        
    - 주요 필드 옵션
        1. null
            
            : 데이터 베이스에서 NULL 값을 허용할 지 여부를 결정(기본값 : False)
            
        2. blank
            
            : form에서 빈 값을 허용할 지 여부를 결정(기본값 : False)
            
        3. default
            
            : 필드의 기본값 설정
            

### Migrations

: model 클래스의 변경사항(필드 생성, 수정, 삭제 등)을 DB에 최종 반영하는 방법

→ 모든 변경 사항이 코드로 관리되어 협업 시 모델 변경 내역에 대한 추적과 공유가 수월함

**Django 모델 클래스와 Migration 과정**

- 모델 정의부터 마이그레이션 파일 생성까지

![image.png](attachment:7529d738-d947-41ce-80f8-e1d73dbee3ea:image.png)

- 모델 클래스 작성/수정
    
    : Django에서는 Python 클래스로 정의함
    
    - CharField : 제한된 길이의 문자열 저장
    - TextField : 길이 제한 없는 대용량 텍스트
- 마이그레이션 파일 생성 명령어
    
    : Python 코드로 된 migration 파일(설계도)를 만드는 방법
    
    - 모델 변경을 감지하고 migration 파일을 생성하는 명령어
    - migration 파일 == 최종 설계도
- 생성된 최종 설계도(001_initial.py) 마이그레이션 파일을 DB에 반영하기

![image.png](attachment:601866f5-8277-4fbd-a609-184b9f729ede:image.png)

- 마이그레이션 파일(0001_initial.py)
    - 마이그레이션 파일을 모델 변경사항을 기록한 Python 코드
    
    → 마이그레이션 파일은 DB 테이블 변경 내역을 순차적으로 저장하여 추적 관리함
    
- SQL 실행(자동 변환)
    - migrate 명령어는 마이그레이션 파일의 Python 코드를 SQL문으로 자동 변환
    - 변환 과정
        
        : Python 코드 → 번역 → SQL 쿼리문 → 데이터 베이스 실행
        

![image.png](attachment:fb8e9d50-5ccf-4da5-abec-632db458010c:image.png)

**Migrations 핵심 명령어 2가지**

1. `$ python [manage.py](http://manage.py) makemigrations`
    - 역할 : model class를 기반으로 최종 설계도(migration)을 작성
2. `$ python [manage.py](http://manage.py) migrate`
    - 역할 : 최종 설계도를 DB에 전달하여 반영

→ 마이그레이션 파일은 되도록 건드리지 않고, migrations 폴더에 자동으로 생성된 파일들은 직접 수정하거나 삭제하지 않는 것이 원칙임

**Migration 경고 메시지**

- Django 서버를 시작할 때 출력되는 migration 관련 경고 메시지
    
    : 프로젝트 실행 시 미적용 마이그레이션 파일이 있을 때 나타남
    
    ![image.png](attachment:639d299a-5963-4568-a409-2ccd4b2c004d:image.png)
    
- 해결 방법
    
    : 경고 메시지에 명시된 대로 `python [manage.py](http://manage.py) migrate` 명령어를 실행
    
- 중요한 이유
    
    : 최신 모델 변경 사항이 데이터 베이스에 반영되지 않아 프로젝트가 제대로 작동하지 않을 수 있음
    

**추가 Migrations**

- 이미 생성된 테이블에 필드를 추가해야 한다면
    
    → 이미 기존 테이블이 존재하는 경우, 새 필드를 추가할 때 문제가 발생할 수 있음
    
    - 기존에 레코드가 있는 테이블에 새로운 필드를 추가하면 어떤 값으로 채울지 결정해야 함
    - Django의 makemigrations 실행 시 기본값 설정을 요구하는 프롬프트가 표시됨
    
    ![image.png](attachment:31ff54c7-48aa-4e37-8fc0-a1ea011ab2f9:image.png)
    

- Migrations 과정_ 추가 모델 필드 작성
    - 새로운 필드 작성
        - 모델 클래스 수정_ Django 기존 모델을 수정함
        
        ![image.png](attachment:9ae8b5c3-77dc-4567-b690-c50f17d17f1a:image.png)
        
        - DateTimeField의 필드 옵션
            1. auto_now
                
                : 데이터가 저장될 때마다 자동으로 현재 날짜, 시간을 저장
                
            2. auto_now_add
                
                : 데이터가 처음 생성될 때만 자동으로 현재 날짜, 시간을 저장
                
    - 새로운 필드 추가 후 makemigrations 명령어 입력(`$ python [manage.py](http://manage.py) makemigrations`)
        
        : 이미 기존 테이블이 존재하기 때문에 필드를 추가할 때 필드의 기본값 설정이 필요함
        
        : 1)은 현재 대화를 유지하면서 직접 기본값을 입력하는 방법
        
        : 2)번은 현재 대화에서 나간 후 models.py에 기본값 관련 설정을 하는 방법
        
        ![image.png](attachment:2ca8a8da-e2b9-4c6b-9ddc-42da3d5b0f29:image.png)
        
        - 옵션 1 : 일회성 기본값 제공
            - 현재 대화형 프롬프트에서 기본값을 직접 입력함
            - 입력한 기본값은 기존의 모든 데이터 행에 적용됨
    - 추가하는 필드의 기본값을 입력해야 하는 상황
        
        → 날짜 데이터이므로 직접 입력하기 보다 Django가 제안하는 기본값을 사용하는 것을 권장
        
        ⇒ 아무것도 입력하지 않고 enter를 누르면 Django가 제안하는 기본값으로 설정됨
        
        ![image.png](attachment:f5a6c072-6e37-4fee-8420-ab29b89cdf76:image.png)
        
    - migrations 과정 종료 후 2번째 migration 파일이 생성됨을 확인
        
        → Django는 설계도를 쌓아가면서 추후 문제가 생겼을 때 복구하거나 되돌릴 수 있도록 함(git commit과 유사함)
        
        ![image.png](attachment:78a76290-3d76-478b-a4e7-488e550568c4:image.png)
        
    - migrate 후 테이블 필드 변화 확인
        
        `$ python [manage.py](http://manage.py) migrate`
        
        ![image.png](attachment:0a69c28f-77dc-4a62-abc6-a307a1b17e05:image.png)
        

- 언제 Migration이 필요한가?
    
    : model class에 **변경사항(1)**이 생겼다면, 반드시 새로운 **설계도를 생성(2)**하고, 이를 **DB에 반영(3)**해야 함
    
    ⇒ (1) model class 생성/수정 → (2) makemigrations → (3) migrate
    

---

### 관리자 인터페이스_ Automatic admin interface

: Django가 추가 설치 및 설정 없이 자동으로 제공하는 관리자 인터페이스

→ Django 관리자 인터페이스는 추가 설정 없이 자동 생성되는 웹 기반 관리 도구임

→ 주요 기능 : 데이터베이스 모델의 CRUD(생성, 읽기, 업데이트, 삭제) 작업을 간편하게 수행할 수 있음

→ 활용 : 빠른 프로토타이핑, 비개발자 데이터 관리, 내부 시스템 구축에 이상적임

1. Django admin 계정 생성
    1. 터미널 열기
        
        : Django 프로젝트 폴더로 이동해서 터미널을 엶(manage.py 파일이 있는 위치에서 진행)
        
    2. 관리자 계정 생성 명령어 입력
        
        `$ python [manage.py](http://manage.py) createsuperuser`
        
    3. 정보 입력
        - 사용자 이름(username) : 관리자 페이지에 로그인할 때 사용할 아이디 입력
        - 이메일(email address) : 선택 사항이라 입력하지 않고 엔터를 눌러 넘어가도 됨
        - 비밀번호(password) : 로그인할 때 사용할 비밀번호 입력(비밀번호 입력 시 콘솔 창에 아무것도 나타나지 않음)
        - 비밀번호 확인(password(again)) : 비밀번호를 한 번 더 입력해서 확인
2. DB에 생성된 admin 계정 확인

![image.png](attachment:9d3cdbd6-0a9c-45eb-aba5-cd45ef216e38:image.png)

1. 관리자 인터페이스 페이지
    
    ![image.png](attachment:b18b5bfb-bc75-47cf-8e36-227b4a9c8087:image.png)
    
2. 관리자 인터페이스 접속 확인
    
    : 로그인 후 아무것도 보이지 않는 것이 정상임 → 만든 모델을 관리하려면 추가 설정 필요
    

![image.png](attachment:f3693eb4-7a9a-4a08-ba04-eeaff786cccf:image.png)

1. Admin site 모델 클래스 등록 및 확인
    
    : admin.py에 작성한 모델 클래스를 등록해야만 admin site에서 확인 가능
    
    ![image.png](attachment:16ce1ba6-46ed-48fd-8e8a-45d95ce7ac81:image.png)
    
    ![image.png](attachment:df187fa5-90e6-4c37-ad35-99621bb2bb2b:image.png)
    
2. 데이터 생성, 수정, 삭제 테스트
    - Articles 앱에서 article에 대한 CRUD(생성, 읽기, 업데이트, 삭제)를 위한 페이지로 이동
        
        ![image.png](attachment:0ac2de47-58c3-4ae9-8963-3af5e22966d8:image.png)
        
    - 새로운 Article 생성
    
    ![image.png](attachment:e3d3a999-3433-4d83-801b-0b21c23e268f:image.png)
    
    - 성공 메시지와 함께 등록된 Article이 모두 조회됨 / 데이터 베이스에서도 확인 가능
    
    ![image.png](attachment:17bf9d3e-0799-4c6e-9a9e-122600750a10:image.png)
    
    - 상세 페이지 내에서 원하는 데이터를 수정 또는 삭제할 수 있음
    
    ![image.png](attachment:cc93f36b-4d3f-4335-a4a3-164a81efd9a1:image.png)
    

---

### 참고

- 데이터 베이스 초기화
    1. Migrations 파일 삭제
        
        : makemigrations 명령어로 생성되는 설계도(Migration 파일)
        
        ![image.png](attachment:cfa0f0cd-7054-4f9c-95f1-c5ea1b63af9e:aa7445de-70d6-4285-826e-48c3be18243c.png)
        
    2. db.sqlite3 파일 삭제

- Migrations 기타 명령어
    1. showmigrations
        
        `$ python [manage.py](http://manage.py) showmigrations`
        
        : migrations 파일들이 migrate 됐는지 안됐는지 여부를 확인하는 명령어
        
        : [X] 표시가 있으면 migrate가 완료됨을 의미
        
    2. sqlmigrate
        
        `$ python [manage.py](http://manage.py) sqlmigrate articles 0001`
        
        : 해당 migrations 파일이 SQL 언어(DB에서 사용하는 언어)로 어떻게 번역되어 DB에 전달되는 지 확인하는 명령어
        
        : python manage.try sqlmigrate <앱 이름> <마이그레이션 이름>
        

- 최초 migrate시 출력 내용이 많은 이유는?
    
    → Django 프로젝트가 동작하기 위해 미리 작성되어 있는 기본 내장 app들에 대한 migration 파일들이 함께 migrate되기 때문
    
    ![image.png](attachment:154b6462-563e-426c-86bc-b7bd154b145c:image.png)
    

- SQLite
    
    : 데이터 베이스 관리 시스템 중 하나로 Django의 기본 데이터 베이스로 사용됨
    
    - 파일 기반 : 데이터 베이스가 하나의 파일로 저장되어, 설치/설정 없이 간편하게 복사/이동/백업 가능함
    - 가볍고 빠름 : 별도의 서버 없이 파일로 직접 데이터 처리, 소규모 앱이나 모바일 환경에 최적화함
    - 높은 호환성 : 다양한 운영체제와 프로그래밍 언어에서 폭넓게 사용 가능함

- SQLite 주의사항
    - db.sqlite3 파일은 Git 등 버전 관리 시스템에서 관리하지 않는 것이 원칙
        
        → 데이터가 변경될 때마다 파일 전체가 변경됨
        
    - SQLite 파일은 로컬 컴퓨터에 저장된 데이터 기록
    - .gitignore 파일에 db.sqlite3을 추가하여 Git 버전 관리에서 제외해야 함
    
    + gitignore.io란?
    
    → gitignore.io는 개발자들이 .gitignore 파일을 쉽게 생성할 수 있도록 도와주는 웹 서비스
    
    → gitignore.io에서 Django를 기술 스택으로 추가한 뒤, .gitignore 파일을 자동 생성하면 db.sqlite3가 자동으로 포함됨